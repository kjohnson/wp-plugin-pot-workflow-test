name: (Not) Release to givewp.com

on:
  workflow_dispatch:

jobs:
  release:
    name: Build & (Not) Release Plugin
    runs-on: ubuntu-latest

    steps:
      -   uses: actions/checkout@v2

      -   name: Install composer dependencies
          uses: php-actions/composer@v6
          with:
            php_version: 7.4
            dev: no

      -   uses: actions/setup-node@v1
          with:
            node-version: '12'

      -   name: Install npm dependencies
          run: |
            npm install -g npm@7
            npm ci
            npm run build

      -   name: Generate pot file
          run: wp i18n make-pot . languages/plugin.pot

      -   name: Generate plugin artifact
          run: |
            rsync -rc --exclude-from="$GITHUB_WORKSPACE/.distignore" "${GITHUB_WORKSPACE}/" ${{ inputs.plugin_slug }}/ --delete --delete-excluded
            zip -r "${GITHUB_WORKSPACE}/release.zip" ${{ inputs.plugin_slug }}